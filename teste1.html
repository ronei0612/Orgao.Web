<!doctype html>
<html lang=pt-br>

<head>
    <meta charset=UTF-8>
    <meta name=viewport content="width=device-width,initial-scale=1">
    <title>Botões de Play e Stop</title>
    <link href=https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css rel=stylesheet>
    <link href=https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.8.1/font/bootstrap-icons.css rel=stylesheet>
    <style>
        body {
            background-color: #f8f9fa;
            /* Usando a cor de fundo padrão do Bootstrap */
            transition: background-color .3s;
        }

        body.dark-mode {
            background-color: #343a40;
            /* Usando a cor escura padrão do Bootstrap */
            color: #fff;
        }

        .modal-content {
            background-color: #fff;
            /* Usando a cor de fundo padrão dos modais do Bootstrap */
            color: #333;
            transition: background-color .3s, color .3s;
        }

        .dark-mode .modal-content {
            background-color: #343a40;
            color: #fff;
        }

        #toggleDarkMode {
            display: flex;
            align-items: center;
        }

        #toggleDarkMode i {
            margin-right: 8px;
        }

        .btn-custom {
            border-radius: 50%;
            color: #fff;
            width: 60px;
            height: 60px;
            font-size: 24px;
            border: none;
            transition: background-color .3s, box-shadow .3s;
            outline: 0;
            user-select: none;
            margin: 8px;
        }

        .btn-play {
            background-color: #007bff;
            /* Usando a cor primária do Bootstrap */
        }

        .btn-play.pressed {
            background-color: #0056b3;
            /* Usando uma cor de foco semelhante do Bootstrap */
            box-shadow: 0 0 10px #0056b3;
        }

        .btn-play.pulse {
            box-shadow: 0 0 20px 5px rgba(0, 123, 255, .7);
        }

        .btn-play:focus {
            outline: 0;
        }

        .btn-stop {
            background-color: #dc3545;
            /* Usando a cor de perigo do Bootstrap */
        }

        .btn-stop.pressed {
            background-color: #bd2130;
            /* Usando uma cor de foco semelhante do Bootstrap */
            box-shadow: 0 0 10px #bd2130;
        }

        .btn-stop.pulse {
            animation: pulseStop 1s infinite;
        }

        .btn-stop:focus {
            outline: 0;
        }

        .btn-search {
            background-color: #28a745;
            /* Usando a cor de sucesso do Bootstrap */
        }

        .btn-search.pressed {
            background-color: #218838;
            /* Usando uma cor de foco semelhante do Bootstrap */
            box-shadow: 0 0 10px #218838;
        }

        .btn-search:focus {
            outline: 0;
        }

        .btn-search:disabled {
            background-color: #28a745;
            cursor: not-allowed;
        }

        .btn-settings {
            background-color: #17a2b8;
            /* Usando a cor de informação do Bootstrap */
        }

        .btn-settings.pressed {
            background-color: #138496;
            /* Usando uma cor de foco semelhante do Bootstrap */
            box-shadow: 0 0 10px #138496;
        }

        .btn-settings:disabled {
            background-color: #17a2b8;
            cursor: not-allowed;
        }

        .btn-settings:focus {
            outline: 0;
        }

        @keyframes pulseStop {
            0% {
                box-shadow: 0 0 10px 0 rgba(255, 69, 0, .7);
            }

            50% {
                box-shadow: 0 0 20px 5px rgba(255, 69, 0, .7);
            }

            100% {
                box-shadow: 0 0 10px 0 rgba(255, 69, 0, .7);
            }
        }

        .bpm-control {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 20px;
        }

        .bpm-control label {
            font-weight: 700;
            color: #4f4f4f;
        }

        body.dark-mode .bpm-control label,
        body.dark-mode .bpm-control span {
            color: #aaa;
        }

        .bpm-control span {
            font-size: 1.2em;
            color: #4f4f4f;
        }

        .bpm-control input[type=range] {
            flex: 1;
        }

        #iframeCifra {
            background-color: #fff;
            border-radius: 8px;
            transition: background-color .3s;
        }

        body.dark-mode #iframeCifra {
            background-color: #343a40;
            color: #fff;
        }

        .list-group-item {
            background-color: #fff;
            border: 1px solid #ccc;
        }

        body.dark-mode .list-group-item {
            background-color: #343a40;
            color: #fff;
            border: 1px solid #555;
        }
    </style>
</head>

<body class="d-flex justify-content-center align-items-center" style=height:100vh>
    <div>
        <iframe width=100% height=400 style="border:1px solid #ccc" id=iframeCifra></iframe>
        <button class="btn-custom btn-play" id=playButton>
            <i class="bi bi-play-fill"></i>
        </button>
        <button class="btn-custom btn-stop pressed pulse" id=stopButton>
            <i class="bi bi-search"></i>
        </button>
        <button class="btn-custom btn-settings pressed" id=settingsButton data-toggle=modal data-target=#settingsModal>
            <i class="bi bi-gear-fill"></i>
        </button>
        <div class=bpm-control>
            <label for=pulseRange>Velocidade do Pulso (BPM):</label>
            <input type=range id=pulseRange min=30 max=240 step=1 value=120>
            <span id=bpmValue>120</span>
        </div>
    </div>
    <div class="modal fade" id=searchModal tabindex=-1 role=dialog aria-labelledby=searchModalLabel aria-hidden=true>
        <div class=modal-dialog role=document>
            <div class=modal-content>
                <div class=modal-header>
                    <h5 class=modal-title id=searchModalLabel>Cifras</h5>
                    <button type=button class=close data-dismiss=modal aria-label=Close>
                        <span aria-hidden=true>×</span>
                    </button>
                </div>
                <div class=modal-body>
                    <div class=input-group>
                        <input class=form-control placeholder="Pesquisar Música..." aria-label=Pesquisar
                            aria-describedby=basic-addon1 id=searchInput>
                        <button class="btn btn-primary" type=button id=searchButton>
                            <span class="spinner-border spinner-border-sm d-none" role=status aria-hidden=true></span>
                            <i class="bi bi-search"></i>
                        </button>
                    </div>
                    <ul class="list-group mt-3" id=searchResults></ul>
                </div>
                <div class=modal-footer>
                    <button type=button class="btn btn-secondary" data-dismiss=modal>Fechar</button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id=settingsModal tabindex=-1 role=dialog aria-labelledby=settingsModalLabel
        aria-hidden=true>
        <div class=modal-dialog role=document>
            <div class=modal-content>
                <div class=modal-header>
                    <h5 class=modal-title id=settingsModalLabel>Configurações</h5>
                    <button type=button class=close data-dismiss=modal aria-label=Close>
                        <span aria-hidden=true>&times;</span>
                    </button>
                </div>
                <div class=modal-body>
                    <button type=button class="btn btn-dark" id=toggleDarkMode>
                        <i class="bi bi-moon-fill"></i> Modo Escuro
                    </button>
                </div>
                <div class=modal-footer>
                    <button type=button class="btn btn-secondary" data-dismiss=modal>Fechar</button>
                </div>
            </div>
        </div>
    </div>
    <script src=https://code.jquery.com/jquery-3.3.1.slim.min.js></script>
    <script src=https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js></script>
    <script>
        const playButton = document.getElementById("playButton"),
            stopButton = document.getElementById("stopButton"),
            settingsButton = document.getElementById("settingsButton"),
            searchButton = document.getElementById("searchButton"),
            searchInput = document.getElementById("searchInput"),
            spinner = searchButton.querySelector(".spinner-border"),
            searchIcon = searchButton.querySelector(".bi-search"),
            searchResultsList = document.getElementById("searchResults"),
            pulseRange = document.getElementById("pulseRange"),
            bpmValue = document.getElementById("bpmValue"),
            toggleDarkModeButton = document.getElementById("toggleDarkMode"),
            iframeCifra = document.getElementById("iframeCifra");

        async function choseLink(urlLink) {
            searchButton.disabled = true;
            spinner.classList.remove('d-none');
            searchIcon.classList.add('d-none');

            try {
                const response = await fetch('https://apinode-h4wt.onrender.com/downloadsite', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ url: urlLink }),
                });

                const data = await response.json();

                if (data.success) {
                    iframeCifra.contentDocument.body.innerHTML = data.message;
                } else {
                    alert(data.message);
                }
            } catch (error) {
                console.error('Error fetching data:', error);
                alert('Erro ao baixar a cifra. Tente novamente mais tarde.');
            } finally {
                searchButton.disabled = false;
                spinner.classList.add('d-none');
                searchIcon.classList.remove('d-none');
            }
        }

        const togglePressedState = (event) => {
            const button = event.currentTarget;
            if (button === playButton) {
                stopButton.classList.remove('pulse');
                stopButton.innerHTML = '<i class="bi bi-stop-fill"></i>';
                playButton.classList.add('pulse');
                settingsButton.disabled = true;
            } else {
                if (button === settingsButton) {
                    $('#settingsModal').modal('show');
                }
                else if (stopButton.innerHTML.includes('bi-search')) {
                    $('#searchModal').modal('show');
                }
                playButton.classList.remove('pressed', 'pulse');
                stopButton.classList.add('pulse');
                stopButton.innerHTML = '<i class="bi bi-search"></i>';
                settingsButton.disabled = false;
            }

            button.classList.remove('pressed');
            setTimeout(() => button.classList.add('pressed'), 100);
        };

        const mudarTempoCompasso = (bpm) => {
            const tempo = parseInt(bpm.value);
            const bpmValor = 60000 / tempo;
            bpmValue.textContent = tempo;

            playButton.style.animationDuration = `${bpmValor}ms`;
            stopButton.style.animationDuration = `${bpmValor}ms`;
        };

        const toggleDarkMode = () => {
            document.body.classList.toggle('dark-mode');
            const isDarkMode = document.body.classList.contains('dark-mode');
            toggleDarkModeButton.innerHTML = isDarkMode ? '<i class="bi bi-brightness-high-fill"></i> Modo Claro' : '<i class="bi bi-moon-fill"></i> Modo Escuro';
            localStorage.setItem('darkMode', isDarkMode);
            aplicarModoEscuroIframe();
        };

        async function searchMusic() {
            searchButton.disabled = true;
            spinner.classList.remove('d-none');
            searchIcon.classList.add('d-none');
            searchResultsList.innerHTML = '';

            const textoPesquisa = searchInput.value;

            try {
                const response = await fetch('https://apinode-h4wt.onrender.com/pesquisar', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ texto: textoPesquisa }),
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();

                if (data.success) {
                    const titles = data.lista;
                    const links = data.links;

                    if (titles.length > 0) {
                        titles.forEach((title, index) => {
                            const listItem = document.createElement('li');
                            listItem.className = 'list-group-item';
                            const link = document.createElement('a');
                            link.href = '#';
                            link.onclick = () => choseLink(links[index]);
                            link.textContent = title;
                            listItem.appendChild(link);
                            searchResultsList.appendChild(listItem);
                        });
                    } else {
                        const listItem = document.createElement('li');
                        listItem.className = 'list-group-item';
                        listItem.textContent = 'Nenhuma cifra encontrada.';
                        searchResultsList.appendChild(listItem);
                    }
                } else {
                    throw new Error(data.message);
                }
            } catch (error) {
                console.error('Erro na busca:', error);
                alert(`Erro na busca: ${error.message}`);
            } finally {
                searchButton.disabled = false;
                spinner.classList.add('d-none');
                searchIcon.classList.remove('d-none');
            }
        }

        const aplicarModoEscuroIframe = () => {
            const iframeDoc = iframeCifra.contentDocument || iframeCifra.contentWindow.document;
            iframeDoc.body.style.color = document.body.classList.contains('dark-mode') ? '#FFFFFF' : '#4F4F4F';
        };

        const savedDarkMode = localStorage.getItem('darkMode') === 'true';
        if (savedDarkMode) {
            document.body.classList.add('dark-mode');
            toggleDarkModeButton.innerHTML = '<i class="bi bi-brightness-high-fill"></i> Modo Claro';
            aplicarModoEscuroIframe();
        }

        pulseRange.addEventListener('input', () => mudarTempoCompasso(pulseRange));
        playButton.addEventListener('mousedown', togglePressedState);
        playButton.addEventListener('touchstart', togglePressedState);
        stopButton.addEventListener('mousedown', togglePressedState);
        stopButton.addEventListener('touchstart', togglePressedState)
        settingsButton.addEventListener('mousedown', togglePressedState);
        settingsButton.addEventListener('touchstart', togglePressedState);
        toggleDarkModeButton.addEventListener('click', toggleDarkMode);
        searchButton.addEventListener('click', searchMusic);

        mudarTempoCompasso(pulseRange);
    </script>
</body>

</html>